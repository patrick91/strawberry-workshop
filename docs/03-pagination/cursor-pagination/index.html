<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" as="font" href="https://patrick91.github.io/strawberry-workshop/fonts/vendor/jost/jost-v4-latin-regular.woff2" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="https://patrick91.github.io/strawberry-workshop/fonts/vendor/jost/jost-v4-latin-700.woff2"  type="font/woff2" crossorigin>


<link rel="stylesheet" href="https://patrick91.github.io/strawberry-workshop/main.css">



  
  
    
  

  
  
    
    
  
  
  
    
  
  
  
  
    
  
  
  


  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">


	


	

<title>Cursor pagination | Production GraphQL workshop</title>
<meta name="description" content="Build a production ready GraphQL API using Strawberry GraphQL">
<link rel="canonical" href="https://patrick91.github.io/strawberry-workshop/docs/03-pagination/cursor-pagination/">










<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://patrick91.github.io/strawberry-workshop/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Docs",
            "item": "https://patrick91.github.io/strawberry-workshop/docs/"
          },
        
      
        
        
        
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "03 Pagination",
            "item": "https://patrick91.github.io/strawberry-workshop/docs/03-pagination/"
          },
        
      
        
        
        
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  4 ,
            "name": "Cursor Pagination",
            "item": "https://patrick91.github.io/strawberry-workshop/docs/03-pagination/cursor-pagination/"
          },
        
      
    
  }
</script>






  <meta name="theme-color" content="#fff">
  <link rel="apple-touch-icon" sizes="180x180" href="https://patrick91.github.io/strawberry-workshop/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://patrick91.github.io/strawberry-workshop/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://patrick91.github.io/strawberry-workshop/favicon-16x16.png">
  
    <link rel="manifest" href="https://patrick91.github.io/strawberry-workshop/site.webmanifest" crossorigin>
  


  

</head>

  

<body class="docs single">
  
  
  
  
<div class="header-bar fixed-top"></div>
<header class="navbar fixed-top navbar-expand-md navbar-light">
	<div class="container">
		<input class="menu-btn order-0" type="checkbox" id="menu-btn">
		<label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>
		<a class="navbar-brand order-1 order-md-0 me-auto" href="https://patrick91.github.io/strawberry-workshop">Production GraphQL workshop</a>
		<button id="mode" class="btn btn-link order-2 order-md-4" type="button" aria-label="Toggle mode">
			<span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span>
			<span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></span>
		</button>
		<ul class="navbar-nav fork-me order-3 order-md-5">
			
				
					<li class="nav-item">
						<a class="nav-link" href="https://twitter.com/patrick91"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg><span class="ms-2 visually-hidden">Twitter</span></a>
					</li>
				
					<li class="nav-item">
						<a class="nav-link" href="https://github.com/patrick91/strawberry-workshop"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ms-2 visually-hidden">GitHub</span></a>
					</li>
				
			
		</ul>
		<div class="collapse navbar-collapse order-4 order-md-1">
			<ul class="navbar-nav main-nav me-auto order-5 order-md-2">
				
					
				
				
				
					
						<li class="nav-item docs active">
							<a class="nav-link" href="https://patrick91.github.io/strawberry-workshop/docs/01-getting-started/introduction/">Docs</a>
						</li>
					
				
			</ul>
			<div class="break order-6 d-md-none"></div>
			
		</div>
	</div>
</header>



  
<div class="wrap container" role="document">
  <div class="content">
    <div class="row flex-xl-nowrap">
	  
<div class="col-lg-5 col-xl-4 docs-sidebar">
	<nav class="docs-links" aria-label="Main navigation">
			
			
			
			
					
					
					
							<h3>Getting started</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/01-getting-started/introduction/">Introduction</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/01-getting-started/setup/">Setup</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/01-getting-started/03-graphiql/">GraphiQL</a></li>
							
					</ul>
					
					
					
					
							<h3>Writing the API</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/02-api/how-it-works/">How GraphQL works</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/02-api/strawberry-overview/">Strawberry Overview</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/02-api/our-first-api/">Our first API</a></li>
							
					</ul>
					
					
					
					
							<h3>Pagination</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/03-pagination/pagination/">Pagination</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/03-pagination/duplicated-code/">Duplicated code</a></li>
							                           
									<li><a class="docs-link active" href="https://patrick91.github.io/strawberry-workshop/docs/03-pagination/cursor-pagination/">Cursor pagination</a></li>
							
					</ul>
					
					
					
					
							<h3>Data fetching optimization</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/04-dataloaders/setup/">Setup</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/04-dataloaders/info/">Introspecting operations</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/04-dataloaders/dataloaders/">Dataloaders</a></li>
							
					</ul>
					
					
					
					
							<h3>Authentication</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/05-authentication/authentication/">Authentication</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/05-authentication/permissions/">Permissions</a></li>
							
					</ul>
					
					
					
					
							<h3>Errors</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/06-errors/errors/">Handling errors</a></li>
							
					</ul>
					
					
					
					
							<h3>Final touches</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/07-final-touches/safety/">Safety</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/07-final-touches/tracing/">Tracing</a></li>
							
					</ul>
					
					
			
	</nav>
</div>

	  
  
  <nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation">
  	<div class="page-links">
  			<h3>On this page</h3>
  			<nav id="TableOfContents">
  					<ul>
  							
  							<li><a href="https://patrick91.github.io/strawberry-workshop/docs/03-pagination/cursor-pagination/#relay-specification">Relay specification</a></li>
  							
  							
  							<li><a href="https://patrick91.github.io/strawberry-workshop/docs/03-pagination/cursor-pagination/#an-example-query">An example query</a></li>
  							
  							
  							<li><a href="https://patrick91.github.io/strawberry-workshop/docs/03-pagination/cursor-pagination/#implementing-the-cursor-pagination">Implementing the cursor pagination</a></li>
  							
  							
  							<li><a href="https://patrick91.github.io/strawberry-workshop/docs/03-pagination/cursor-pagination/#using-python-s-generic-types">Using python&#x27;s generic types</a></li>
  							
  							
  							<li><a href="https://patrick91.github.io/strawberry-workshop/docs/03-pagination/cursor-pagination/#using-the-generic-types">Using the generic types</a></li>
  							
  							
  					</ul>
  			</nav>
  	</div>
  </nav>
  

      <main class="docs-content col-lg-11 col-xl-9">
        <h1>Cursor pagination</h1>
        
        <p>As mentioned in the previous section we can use cursor pagination when we have a
lot of data as using an offset based pagination might not be performant.</p>
<p>In this section we'll see how we can implement a cursor based pagination for our
API. We'll allow our users to paginate the podcasts by passing a <code>cursor</code> and
we'll be using the
<a href="https://relay.dev/graphql/connections.htm">relay specification</a> to do so.</p>
<h2 id="relay-specification">Relay specification</h2>
<p>The relay specification defines how we can implement a cursor based pagination
for our API. It defines a <code>Connection</code> type that contains a list of nodes and
some metadata about the pagination.</p>
<p>The <code>Connection</code> type also defines a <code>PageInfo</code> type that contains information
about the current page and if there are more pages.</p>
<p>The <code>PageInfo</code> type contains the following fields: <code>hasNextPage</code>,
<code>hasPreviousPage</code>, <code>startCursor</code> and <code>endCursor</code>.</p>
<p>The <code>startCursor</code> and <code>endCursor</code> fields are the cursors for the first and last
node in the list of nodes.</p>
<h2 id="an-example-query">An example query</h2>
<pre data-lang="graphql" style="background-color:#2b303b;color:#c0c5ce;" class="language-graphql "><code class="language-graphql" data-lang="graphql"><span>{
</span><span>  podcasts(</span><span style="color:#bf616a;">first</span><span>: </span><span style="color:#d08770;">2</span><span>) {
</span><span>    pageInfo {
</span><span>      hasNextPage
</span><span>    }
</span><span>    edges {
</span><span>      cursor
</span><span>      node {
</span><span>        title
</span><span>      }
</span><span>    }
</span><span>  }
</span><span>}
</span></code></pre>
<p>This query is more verbose than the previous one, but it provides us with more
information about the pagination.</p>
<h2 id="implementing-the-cursor-pagination">Implementing the cursor pagination</h2>
<p>As with all our previous examples we also have function inside the data module
that will allow us to paginate data using cursors. The function is called
<code>find_podcasts</code> and allows to pass a <code>first</code> and <code>after</code> argument.</p>
<blockquote>
<p>Note: we are not implementing <code>before</code> and <code>last</code> but they can be implemented
in a similar way.</p>
</blockquote>
<p>Under the hood <code>find_podcasts</code> uses <code>django-cursor-pagination</code> to paginate the
data using performant cursors.</p>
<p>Before being able to implement the resolver, we need to implement the types for
our pagination. The types we need to create are the following:</p>
<ul>
<li><code>PodcastConnection</code> which is what will be returned by the <code>podcasts</code> field.</li>
<li><code>PageInfo</code> which is the type for the <code>pageInfo</code> field.</li>
<li><code>PodcastEdge</code> which is the type for the <code>edges</code> field.</li>
</ul>
<h2 id="using-python-s-generic-types">Using python's generic types</h2>
<p>Implementing these types all by hand can be tedious and error prone. Luckily
python has a feature called
<a href="https://docs.python.org/3/library/typing.html#generics">generic types</a> that
allows us to create types that can be reused.</p>
<p>Strawberry is able to use Python's generic types to create types for us. Our
project has these generic types already implemented for us, so we can use them
to create our types.</p>
<p>They are defined inside <code>api/pagination/types.py</code> and look like this:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>typing </span><span style="color:#b48ead;">import </span><span>Generic, TypeVar, Optional
</span><span>
</span><span style="color:#b48ead;">import </span><span>strawberry
</span><span>
</span><span style="color:#b48ead;">from </span><span>db.pagination </span><span style="color:#b48ead;">import </span><span>PageInfo </span><span style="color:#b48ead;">as </span><span>DBPageInfo
</span><span>
</span><span>
</span><span>Node = </span><span style="color:#bf616a;">TypeVar</span><span>(&quot;</span><span style="color:#a3be8c;">Node</span><span>&quot;)
</span><span>
</span><span>
</span><span>@strawberry.</span><span style="color:#bf616a;">type
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">PageInfo</span><span style="color:#eff1f5;">:
</span><span>    has_next_page: bool
</span><span>    has_previous_page: bool
</span><span>    start_cursor: Optional[str]
</span><span>    end_cursor: Optional[str]
</span><span>
</span><span>
</span><span>@strawberry.</span><span style="color:#bf616a;">type
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Edge</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">Generic</span><span style="color:#eff1f5;">[Node]):
</span><span>    node: Node
</span><span>    cursor: str
</span><span>
</span><span>
</span><span>@strawberry.</span><span style="color:#bf616a;">type
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Connection</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">Generic</span><span style="color:#eff1f5;">[Node]):
</span><span>    edges: list[Edge[Node]]
</span><span>    page_info: PageInfo
</span></code></pre>
<p>We have defined the 3 types we need to implement our pagination, two of them use
python's generic types, <code>Edge</code> and <code>Connection</code>. We can use these types to
create our types for the pagination.</p>
<h2 id="using-the-generic-types">Using the generic types</h2>
<p>We can use the generic types to create our types for the pagination. We can
immediately use them when defining our field and resolver for the <code>podcasts</code>
field.</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">import </span><span>strawberry
</span><span style="color:#b48ead;">from </span><span>typing </span><span style="color:#b48ead;">import </span><span>Optional
</span><span>
</span><span style="color:#b48ead;">from </span><span>api.pagination.types </span><span style="color:#b48ead;">import </span><span>Connection, Edge, PageInfo
</span><span style="color:#b48ead;">from </span><span>db </span><span style="color:#b48ead;">import </span><span>data
</span><span>
</span><span style="color:#b48ead;">from .</span><span>types </span><span style="color:#b48ead;">import </span><span>Podcast
</span><span>
</span><span>
</span><span>@strawberry.</span><span style="color:#bf616a;">type
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">PodcastsQuery</span><span style="color:#eff1f5;">:
</span><span>    </span><span style="color:#65737e;"># ... keep the other fields
</span><span>    @strawberry.</span><span style="color:#bf616a;">field
</span><span>    </span><span style="color:#b48ead;">async def </span><span style="color:#8fa1b3;">podcasts</span><span>(
</span><span>        </span><span style="color:#bf616a;">self</span><span>,
</span><span>        </span><span style="color:#bf616a;">first</span><span>: int = </span><span style="color:#d08770;">10</span><span>,
</span><span>        </span><span style="color:#bf616a;">after</span><span>: Optional[strawberry.</span><span style="color:#bf616a;">ID</span><span>] = </span><span style="color:#d08770;">None</span><span>,
</span><span>    ) -&gt; Connection[Podcast]:
</span><span>        </span><span style="color:#b48ead;">if </span><span>first &gt; </span><span style="color:#d08770;">50</span><span>:
</span><span>            </span><span style="color:#b48ead;">raise </span><span style="color:#bf616a;">ValueError</span><span>(&quot;</span><span style="color:#a3be8c;">per page must be less than 50</span><span>&quot;)
</span><span>
</span><span>        paginated_cursors = </span><span style="color:#b48ead;">await </span><span>data.</span><span style="color:#bf616a;">find_podcasts</span><span>(
</span><span>            </span><span style="color:#bf616a;">first</span><span>=first,
</span><span>            </span><span style="color:#bf616a;">after</span><span>=</span><span style="color:#bf616a;">str</span><span>(after) </span><span style="color:#b48ead;">if </span><span>after is not </span><span style="color:#d08770;">None </span><span style="color:#b48ead;">else </span><span style="color:#d08770;">None</span><span>,
</span><span>        )
</span><span>
</span><span>        page_info = PageInfo.</span><span style="color:#bf616a;">from_db</span><span>(paginated_cursors.page_info)
</span><span>
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">Connection</span><span>(
</span><span>            </span><span style="color:#bf616a;">page_info</span><span>=page_info,
</span><span>            </span><span style="color:#bf616a;">edges</span><span>=[
</span><span>                </span><span style="color:#bf616a;">Edge</span><span>(</span><span style="color:#bf616a;">node</span><span>=Podcast.</span><span style="color:#bf616a;">from_db</span><span>(edge.node), </span><span style="color:#bf616a;">cursor</span><span>=edge.cursor)
</span><span>                </span><span style="color:#b48ead;">for </span><span>edge </span><span style="color:#b48ead;">in </span><span>paginated_cursors.edges
</span><span>            ],
</span><span>        )
</span></code></pre>
<p>We can see that we are using the <code>Connection</code> type to define the return type of
our field by doing <code>Connection[Podcast]</code>. Strawberry is able to use the generic
type to create the type for us, it will automatically create a type called
<code>PodcastConnection</code> that will be added to our schema. This is done recursively
for all types that use the TypeVar, so we'll also have a <code>PodcastEdge</code> type
defined for us.</p>
<p>If you want to learn more about pagination feel free to read this article:
<a href="https://www.apollographql.com/blog/graphql/pagination/understanding-pagination-rest-graphql-and-relay/">https://www.apollographql.com/blog/graphql/pagination/understanding-pagination-rest-graphql-and-relay/</a></p>

        
        <!-- 
<div class="docs-navigation d-flex justify-content-between">
  
  
  
  
  
    
    
    
    
      
        
        
          
        
      
        
        
          
        
      
        
        
          
        
      
        
        
          
        
      
        
        
          
        
      
        
        
          
            
              
              <a href="https:&#x2F;&#x2F;patrick91.github.io&#x2F;strawberry-workshop&#x2F;docs&#x2F;02-api&#x2F;our-first-api&#x2F;">
                <div class="card my-1">
                  <div class="card-body py-2">
                    &larr; Our first API
                  </div>
                </div>
              </a>
            
            
            
          
        
      
        
        
          
        
      
    
  

  
  
  
  
  
    
    
    
      
      
        
      
    
      
      
        
      
    
      
      
        
      
    
      
      
        
          
          
          <a class="ms-auto" href="https:&#x2F;&#x2F;patrick91.github.io&#x2F;strawberry-workshop&#x2F;docs&#x2F;04-dataloaders&#x2F;setup&#x2F;">
            <div class="card my-1">
              <div class="card-body py-2">
                Setup &rarr;
              </div>
            </div>
          </a>
          
          
          
        
      
    
      
      
        
      
    
      
      
        
      
    
      
      
        
      
    
  
</div>
 -->
      </main>
    </div>
  </div>
</div>


  
    
<footer class="footer text-muted">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 order-last order-lg-first">
				<ul class="list-inline">
					
						<li class="list-inline-item">Built by <a href="https://twitter.com/patrick91">Patrick Arminio</a></li>
					
				</ul>
			</div>
			<div class="col-lg-8 order-first order-lg-last text-lg-end">
				<ul class="list-inline">
					
				</ul>
			</div>
		</div>
	</div>
</footer>

  

  
<script type="text/javascript" src="https://patrick91.github.io/strawberry-workshop/js/main.js" defer></script>

  
</body>
</html>
