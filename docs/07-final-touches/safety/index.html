<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" as="font" href="https://patrick91.github.io/strawberry-workshop/fonts/vendor/jost/jost-v4-latin-regular.woff2" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="https://patrick91.github.io/strawberry-workshop/fonts/vendor/jost/jost-v4-latin-700.woff2"  type="font/woff2" crossorigin>


<link rel="stylesheet" href="https://patrick91.github.io/strawberry-workshop/main.css">



  
  
    
  

  
  
    
    
  
  
  
    
  
  
  
  
    
  
  
  


  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">


	


	

<title>Safety | Production GraphQL workshop</title>
<meta name="description" content="Build a production ready GraphQL API using Strawberry GraphQL">
<link rel="canonical" href="https://patrick91.github.io/strawberry-workshop/docs/07-final-touches/safety/">










<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://patrick91.github.io/strawberry-workshop/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Docs",
            "item": "https://patrick91.github.io/strawberry-workshop/docs/"
          },
        
      
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "07 Final Touches",
            "item": "https://patrick91.github.io/strawberry-workshop/docs/07-final-touches/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  4 ,
            "name": "Safety",
            "item": "https://patrick91.github.io/strawberry-workshop/docs/07-final-touches/safety/"
          },
        
      
    
  }
</script>






  <meta name="theme-color" content="#fff">
  <link rel="apple-touch-icon" sizes="180x180" href="https://patrick91.github.io/strawberry-workshop/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://patrick91.github.io/strawberry-workshop/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://patrick91.github.io/strawberry-workshop/favicon-16x16.png">
  
    <link rel="manifest" href="https://patrick91.github.io/strawberry-workshop/site.webmanifest" crossorigin>
  


  

</head>

  

<body class="docs single">
  
  
  
  
<div class="header-bar fixed-top"></div>
<header class="navbar fixed-top navbar-expand-md navbar-light">
	<div class="container">
		<input class="menu-btn order-0" type="checkbox" id="menu-btn">
		<label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>
		<a class="navbar-brand order-1 order-md-0 me-auto" href="https://patrick91.github.io/strawberry-workshop">Production GraphQL workshop</a>
		<button id="mode" class="btn btn-link order-2 order-md-4" type="button" aria-label="Toggle mode">
			<span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span>
			<span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></span>
		</button>
		<ul class="navbar-nav fork-me order-3 order-md-5">
			
				
					<li class="nav-item">
						<a class="nav-link" href="https://twitter.com/patrick91"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg><span class="ms-2 visually-hidden">Twitter</span></a>
					</li>
				
					<li class="nav-item">
						<a class="nav-link" href="https://github.com/patrick91/strawberry-workshop"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ms-2 visually-hidden">GitHub</span></a>
					</li>
				
			
		</ul>
		<div class="collapse navbar-collapse order-4 order-md-1">
			<ul class="navbar-nav main-nav me-auto order-5 order-md-2">
				
					
				
				
				
					
						<li class="nav-item docs active">
							<a class="nav-link" href="https://patrick91.github.io/strawberry-workshop/docs/01-getting-started/introduction/">Docs</a>
						</li>
					
				
			</ul>
			<div class="break order-6 d-md-none"></div>
			
		</div>
	</div>
</header>



  
<div class="wrap container" role="document">
  <div class="content">
    <div class="row flex-xl-nowrap">
	  
<div class="col-lg-5 col-xl-4 docs-sidebar">
	<nav class="docs-links" aria-label="Main navigation">
			
			
			
			
					
					
					
							<h3>Getting started</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/01-getting-started/introduction/">Introduction</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/01-getting-started/setup/">Setup</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/01-getting-started/03-graphiql/">GraphiQL</a></li>
							
					</ul>
					
					
					
					
							<h3>Writing the API</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/02-api/how-it-works/">How GraphQL works</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/02-api/strawberry-overview/">Strawberry Overview</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/02-api/our-first-api/">Our first API</a></li>
							
					</ul>
					
					
					
					
							<h3>Pagination</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/03-pagination/pagination/">Pagination</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/03-pagination/duplicated-code/">Duplicated code</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/03-pagination/cursor-pagination/">Cursor pagination</a></li>
							
					</ul>
					
					
					
					
							<h3>Data fetching optimization</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/04-dataloaders/setup/">Setup</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/04-dataloaders/info/">Introspecting operations</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/04-dataloaders/dataloaders/">Dataloaders</a></li>
							
					</ul>
					
					
					
					
							<h3>Authentication</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/05-authentication/authentication/">Authentication</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/05-authentication/permissions/">Permissions</a></li>
							
					</ul>
					
					
					
					
							<h3>Errors</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/06-errors/errors/">Handling errors</a></li>
							
					</ul>
					
					
					
					
							<h3>Final touches</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link active" href="https://patrick91.github.io/strawberry-workshop/docs/07-final-touches/safety/">Safety</a></li>
							                           
									<li><a class="docs-link" href="https://patrick91.github.io/strawberry-workshop/docs/07-final-touches/tracing/">Tracing</a></li>
							
					</ul>
					
					
			
	</nav>
</div>

	  
  
  <nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation">
  	<div class="page-links">
  			<h3>On this page</h3>
  			<nav id="TableOfContents">
  					<ul>
  							
  							<li><a href="https://patrick91.github.io/strawberry-workshop/docs/07-final-touches/safety/#query-depth">Query Depth</a></li>
  							
  							
  							<li><a href="https://patrick91.github.io/strawberry-workshop/docs/07-final-touches/safety/#query-complexity">Query Complexity</a></li>
  							
  							
  					</ul>
  			</nav>
  	</div>
  </nav>
  

      <main class="docs-content col-lg-11 col-xl-9">
        <h1>Safety</h1>
        
        <p>GraphQL gives clients a lot of flexibility to make queries, but it can also be
dangerous if not used properly.</p>
<h2 id="query-depth">Query Depth</h2>
<p>GraphQL queries can be nested arbitrarily deep. This can be a problem if an
attacker is able to craft a query that is very deep and causes your server to
work very hard to resolve it.</p>
<p>For example, supposed we implemented a list of episode for a podcast, we could
allow queries like this:</p>
<pre data-lang="graphql" style="background-color:#2b303b;color:#c0c5ce;" class="language-graphql "><code class="language-graphql" data-lang="graphql"><span>{
</span><span>  podcasts(</span><span style="color:#bf616a;">first</span><span>: </span><span style="color:#d08770;">50</span><span>) {
</span><span>    edges {
</span><span>      node {
</span><span>        title
</span><span>        episodes(</span><span style="color:#bf616a;">first</span><span>: </span><span style="color:#d08770;">50</span><span>) {
</span><span>          title
</span><span>        }
</span><span>      }
</span><span>    }
</span><span>  }
</span><span>}
</span></code></pre>
<p>which is fine on its own, but we also allowed clients to fetch the podcast on
the episode node, so we could also run the following query:</p>
<pre data-lang="graphql" style="background-color:#2b303b;color:#c0c5ce;" class="language-graphql "><code class="language-graphql" data-lang="graphql"><span>{
</span><span>  podcasts(</span><span style="color:#bf616a;">first</span><span>: </span><span style="color:#d08770;">50</span><span>) {
</span><span>    edges {
</span><span>      node {
</span><span>        title
</span><span>        episodes(</span><span style="color:#bf616a;">first</span><span>: </span><span style="color:#d08770;">50</span><span>) {
</span><span>          podcast {
</span><span>            episodes(</span><span style="color:#bf616a;">first</span><span>: </span><span style="color:#d08770;">50</span><span>) {
</span><span>              podcast {
</span><span>                episodes(</span><span style="color:#bf616a;">first</span><span>: </span><span style="color:#d08770;">50</span><span>) {
</span><span>                  podcast {
</span><span>                    title
</span><span>                    </span><span style="color:#65737e;"># ...
</span><span>                  }
</span><span>                }
</span><span>              }
</span><span>            }
</span><span>          }
</span><span>        }
</span><span>      }
</span><span>    }
</span><span>  }
</span><span>}
</span></code></pre>
<p>This query is very deep and could cause our server to work very hard to resolve
it, which could lead to a denial of service attack.</p>
<p>To prevent this, we can limit the depth of the query by using the
<code>QueryDepthLimiter</code> extension provided by Strawberry:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>strawberry.extensions.query_depth_limiter </span><span style="color:#b48ead;">import </span><span>QueryDepthLimiter
</span><span>
</span><span style="color:#d08770;">...
</span><span>
</span><span>
</span><span>schema = strawberry.</span><span style="color:#bf616a;">Schema</span><span>(
</span><span>    </span><span style="color:#bf616a;">query</span><span>=Query,
</span><span>    </span><span style="color:#bf616a;">mutation</span><span>=Mutation,
</span><span>    </span><span style="color:#bf616a;">extensions</span><span>=[
</span><span>        </span><span style="color:#65737e;"># 8 is the maximum depth in this case
</span><span>        </span><span style="color:#bf616a;">QueryDepthLimiter</span><span>(</span><span style="color:#d08770;">8</span><span>),
</span><span>    ],
</span><span>)
</span></code></pre>
<h2 id="query-complexity">Query Complexity</h2>
<p>Another approach to prevent queries that are too complex is to limit the
complexity of the query. This is similar to the query depth, but instead of
limiting the depth of the query, we limit the complexity of the query.</p>
<p>For example, if we have a query like this:</p>
<pre data-lang="graphql" style="background-color:#2b303b;color:#c0c5ce;" class="language-graphql "><code class="language-graphql" data-lang="graphql"><span>{
</span><span>  podcasts(</span><span style="color:#bf616a;">first</span><span>: </span><span style="color:#d08770;">50</span><span>) {
</span><span>    edges {
</span><span>      node {
</span><span>        title
</span><span>        episodes(</span><span style="color:#bf616a;">first</span><span>: </span><span style="color:#d08770;">50</span><span>) {
</span><span>          title
</span><span>        }
</span><span>      }
</span><span>    }
</span><span>  }
</span><span>}
</span></code></pre>
<p>we can assign a complexity to the fields that can be paginated and that
complexity will be equal to the number of items requested, times the complexity
of parent.</p>
<p>For example in this case, the complexity of the <code>episodes</code> field would be 50,
and the complexity of the <code>podcasts</code> field would be 50 * 50 = 2500. So the
total complexity of the query would be 2550.</p>
<pre data-lang="graphql" style="background-color:#2b303b;color:#c0c5ce;" class="language-graphql "><code class="language-graphql" data-lang="graphql"><span>{
</span><span>  </span><span style="color:#65737e;"># complexity: 50
</span><span>  podcasts(</span><span style="color:#bf616a;">first</span><span>: </span><span style="color:#d08770;">50</span><span>) {
</span><span>    edges {
</span><span>      node {
</span><span>        title
</span><span>        </span><span style="color:#65737e;"># complexity: 50 * 50 = 2500
</span><span>        episodes(</span><span style="color:#bf616a;">first</span><span>: </span><span style="color:#d08770;">50</span><span>) {
</span><span>          title
</span><span>        }
</span><span>      }
</span><span>    }
</span><span>  }
</span><span>}
</span></code></pre>
<p>Unfortunately this is not yet built into Strawberry, but it can be implemented
creating an Extension.</p>

        
        <!-- 
<div class="docs-navigation d-flex justify-content-between">
  
  
  
  
  
    
    
    
    
      
        
        
          
        
      
        
        
          
            
              
              <a href="https:&#x2F;&#x2F;patrick91.github.io&#x2F;strawberry-workshop&#x2F;docs&#x2F;06-errors&#x2F;errors&#x2F;">
                <div class="card my-1">
                  <div class="card-body py-2">
                    &larr; Handling errors
                  </div>
                </div>
              </a>
            
            
            
          
        
      
        
        
          
        
      
        
        
          
        
      
        
        
          
        
      
        
        
          
        
      
        
        
          
        
      
    
  

  
  
  
  
  
    
    
    
      
      
        
      
    
      
      
        
      
    
      
      
        
      
    
      
      
        
      
    
      
      
        
      
    
      
      
        
      
    
      
      
        
      
    
  
</div>
 -->
      </main>
    </div>
  </div>
</div>


  
    
<footer class="footer text-muted">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 order-last order-lg-first">
				<ul class="list-inline">
					
						<li class="list-inline-item">Built by <a href="https://twitter.com/patrick91">Patrick Arminio</a></li>
					
				</ul>
			</div>
			<div class="col-lg-8 order-first order-lg-last text-lg-end">
				<ul class="list-inline">
					
				</ul>
			</div>
		</div>
	</div>
</footer>

  

  
<script type="text/javascript" src="https://patrick91.github.io/strawberry-workshop/js/main.js" defer></script>

  
</body>
</html>
